#!/usr/bin/env perl

# finds lines containing {v1, v2, ...}
#                        [v1, v2, ...]
# and sorts them by the values.

$testname = $ARGV[0];
$goodfile = $ARGV[1];
$comp = $ARGV[2];

# We should really have prediff pass in the precise name of the tmp
# file being pre-diff'd but apprently we don't?  This is a lame way
# to make a good guess at it, that's fragile if things break.
$tmp_file = glob "$testname.*exec.out.tmp";

open TMPFILE, "$tmp_file" or die "can't open $tmp_file $!";
my @lines = <TMPFILE>;
close (TMPFILE);
foreach my $line (@lines) {
    chomp($line);
}

open OUTFILE, ">$tmp_file" or die "can't open $tmp_file for writing $!";

foreach (@lines) {
  s/\{( *)([^\}]*)\}/"{" . $1 . fixInner($2) . "}"/ge;
  s/\[( *)([^\]]*)\]/"[" . $1 . fixInner($2) . "]"/ge;
  print OUTFILE $_ . "\n";
}

close(OUTFILE);

sub fixInner {
  my $arg = shift;
  chomp($arg);
  my @words = split(', *', $arg);
  my @sorted_words = sort @words;
  return join(', ', @sorted_words);
}

