#!/usr/bin/csh

#
# unsetenv normal Chapel environment variables
#
unsetenv CHPL_HOME
unsetenv CHPL_NIGHTLY_LOGDIR
unsetenv CHPL_NIGHTLY_STATDIR
unsetenv CHPL_DEVELOPER
unsetenv CHPL_PLATFORM
unsetenv CHPL_UW_CVS_USERNAME
unsetenv CVSROOT
unsetenv CHPLDEVTMP

#
# execute actions specified in README
#
gmake
set tmpstatus = $status
if ($tmpstatus != 0) then
    echo "ERROR: gmake failed"
    exit($tmpstatus)
endif
source util/setchplenv.csh
set tmpstatus = $status
if ($tmpstatus != 0) then
    echo "ERROR: source of setchplenv.csh failed"
    exit($tmpstatus)
endif
chpl -o hello examples/hello.chpl
set tmpstatus = $status
if ($tmpstatus != 0) then
    echo "ERROR: compilation of hello.chpl failed"
    exit($tmpstatus)
endif
./hello
set tmpstatus = $status
if ($tmpstatus != 0) then
    echo "ERROR: execution of hello failed"
    exit($tmpstatus)
endif


#
# run make in examples directory
#
cd examples
make
cd ..


#
# run test system on examples directory
#
cd examples
set tmpstatus = $status
if ($tmpstatus != 0) then
    echo "ERROR: cd into examples failed"
    exit($tmpstatus)
endif
start_test -logfile Logs/testReleaseHelp.log
set tmpstatus = $status
if ($tmpstatus != 0) then
    echo "ERROR: testing of examples failed"
    exit($tmpstatus)
endif

exit(0)
