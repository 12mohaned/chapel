                                   Checklist
                                       of
                             Issues to be Resolved

         prior to merging the hierarchical_locales branch back to trunk


NEW/CHANGED:

- Replace all calls to PRIM_CHPL_ALLOC with chpl_here_alloc. [hilde]
  d Fix deallocation-before-breakLabel (memory leak) bug. (moved to trunk)
    * OK to leak memory pending fix on trunk
    d Create a future against trunk to demo the bug.
  - parallel.cpp (3)
  * wrappers.cpp
  - lowerIterators.cpp (2)
  * functionResolution.cpp
  - runtime

- Whether to interpose an alloc(loc, nbytes, md) layer between chpl_here_alloc()
  and locale.alloc() [yes]
  i The intent is to avoid dynamic dispatch through "here"
    i Works only if binding of code to allocators can be made at compile time
  a Have chpl_here_alloc() call an architecturally-defined alloc() routine after
    the architecture is initialized.
    o Implement alloc() as part of the DefaultArchitecture (part of architecture interface)
      o Allow that version to be controlled by a config param, to allow SxS
        testing of "flat" versus dynamically-dispatched allocations.
    o Use the config param to characterize the impact of flat MM vs. LAMM.
  * The above has been replaced by calls through task-private allocator
    interfaces.
  o Update generated wrapper code to redirect allocators to locale-specific versions.

* Move mem tracking into chpl_here_alloc.
  * Preserve filename/lineno information: md + filename + lineno.
  * Preserve pre/post checks.
  * Package pre/post checks in hook functions (restore control by CHPL_MEM_DEBUG &c).[gbt]
    - Call these functions from the module code.
      o Implement PRIM_CAST_TO_VOID_STAR.
  * Mem counts are different because we call string_copy when passing the
    filename arguments into chpl_here_alloc and chpl_here_free now.
    * Local strings are shared (and leaked).

- Merge DefaultArchitecture, RootLocale out from trunk (to pick up Vass-inspired
  changes).

- Passes relevant regression tests
  * Standard
  * No-local
  o Parallel


RESOLVED/UNCHANGED:

o Merge to trunk environment setting of numThreadsPerLocale and callStackSize? [gbt]

* Characterize language impacts of allowing sync vars to be dispatched as objects.
  i Greg says this is OK.
  * Create a future for dispatch of sync as object. [bradc]

* Get allocCleanup patch reviewed and checked into trunk. [vass]

d Ensure that all important cases are covered by chpl_maybeAutoDestroyed().

* Whether to pass the destination locale to chpl_here_alloc() [no]
  i Not necessary using the "proxy" model


Key:    o -- open       - -- in progress    * -- done       ! -- blocked
    > -- dependency     i -- information    d -- deferred   a -- abandoned

