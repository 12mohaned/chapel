\lstdefinelanguage{chapel}
  {
    morekeywords={
      align, as, atomic,
      begin, bool, borrowed, break, by,
      catch, class, cobegin, coforall, complex, config, const, continue,
      defer, delete, dmapped, do, domain,
      else, enum, except, export, extern,
      false, for, forall, forwarding,
      if, imag, in, index, inline, inout, int, iter,
      label, lambda, let, lifetime, local, locale,
      module,
      new, nil, noinit,
      on, only, opaque, otherwise, out, override, owned,
      param, pragma, primitive, private, proc, prototype, public,
      range, real, record, reduce, ref, require, return,
      scan, select, serial, shared, single, sparse, string, subdomain, sync,
      then, this, throw, throws, true, try, type,
      uint, union, unmanaged, use,
      var,
      when, where, while, with,
      yield,
      zip
    },
    sensitive=false,
    mathescape=true,
    morecomment=[l]{//},
    morecomment=[s]{/*}{*/},
    morestring=[b]",
}

\lstset{
    basicstyle=\footnotesize\ttfamily,
    keywordstyle=\bfseries,
    commentstyle=\em,
    showstringspaces=false,
    flexiblecolumns=false,
    numbers=left,
    numbersep=5pt,
    numberstyle=\tiny,
    numberblanklines=false,
    stepnumber=0,
    escapeinside={(*}{*)},
    language=chapel,
  }

%\newcommand{\chpl}[1]{\lstinline[language=chapel,basicstyle=\ttfamily,keywordstyle=\bfseries]!#1!}
%\newcommand{\chpl}[1]{\lstinline[language=chapel,basicstyle=\small\ttfamily,keywordstyle=]!#1!}


%\newverbcommand{\chpl}{}{} -- ? problems
%\def\chpl#1{\texttt{\detokenize{#1}}} -- ? problems
% \newcommand{\chpl}[1]{\texttt{#1}} -- does not allow _
%\newcommand{\chpl}[1]{\texttt{#1}} -- does not allow _
\newcommand{\chpl}[1]{\Verb!#1!}
\newcommand{\varname}[1]{\emph{#1}}
\newcommand{\typename}[1]{\emph{#1}}
\newcommand{\fnname}[1]{\chpl{#1}}

\DefineVerbatimEnvironment{chapel}{Verbatim}{}

\DefineVerbatimEnvironment{invisible}{Verbatim}{}
\DefineVerbatimEnvironment{chapel0}{Verbatim}{}
\DefineVerbatimEnvironment{numberedchapel}{Verbatim}{numbers=left}
\DefineVerbatimEnvironment{chapelcode}{Verbatim}{}
\DefineVerbatimEnvironment{chapelprintoutput}{Verbatim}{}
\DefineVerbatimEnvironment{chapeloutputname}{Verbatim}{}
\DefineVerbatimEnvironment{commandline}{Verbatim}{}
\DefineVerbatimEnvironment{protohead}{Verbatim}{}
\DefineVerbatimEnvironment{protobody}{Verbatim}{}
