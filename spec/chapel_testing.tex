%
% These are special environments for adding extra information about
% code snippets which can be later extracted and used to generate test
% codes for automated testing.
%
% During LaTeX compilation, the environments defined in this file throw
% away all text within the scope of the environment, with the
% exception of 'chapelprintoutput' which prints the output (and is
% also extracted for testing purposes).
%
% Usage:
%
% - chapelexample (REQUIRED) {f.chpl}
%   This marks the start of a test.  This environment requires a
%   single argument that is the name of the Chapel test program.  This
%   filename will appear in the spec.
%
% - chapelpre
%   Any Chapel code in this scope is put *before* the code in the
%   chapel|chapelcode scope.
%
% - chapelcode|chapel
%   This is the part of the code that is in the spec.
%
% - chapelnoprint
%   This is the part of the code that goes in the test with chapelcode
%   and chapel, but does not appear in the spec.
%   
% - chapelpost
%   Any Chapel code in this scope is put *after* the code in the
%   chapel|chapelcode scope.
%
% - chapelfuture
% - chapelcompopts
% - chapelexecopts
%   The lines in these scopes are put directly into the appropriate file.
%
% - chapeloutput|chapelprintoutput (REQUIRED)
%   These environment provide the test output (.good files).  There can be
%   multiple such environments, and the filename is specified by a LaTeX
%   style comment preceding the contents of the output.  The
%   'chapelprintoutput' scope is also outputted in the spec itself and
%   thus may contain LaTeX formatting (see GENERAL CAVEATS below)
%   
% - chapelwideoutput
%   Provides the test output for no-local tests, if that differs from the
%   normal test output.  The content of this environment is dumped into a
%   <test>.no-local.good file, along with a copy of the content of 
%   chplprintoutput.
%

%
% GENERAL CAVEATS:
%
% - Because the chapelprintoutput environment must used LaTeX
%   formatting, the script that extracts the tests must removed any
%   LaTeX specific formatting.
%
% - Using a backslash or other special LaTeX characters may also be
%   needed (e.g., \_ or \#) in the other environments for LaTex
%   parsing purposes.  Such characters are considered fragile and may
%   lead to unexpected results.
%

%
% Gobble up the text in this new box.  The text in each environment is
% dropped on the floor during LaTeX compilation.
%
\newsavebox{\teststuff}

%
% Any additional lines needed for the code snippet to run/compile
% (before and after the chapel code segment)
%
%\newenvironment{chapelpre} {\begin{lrbox}{\teststuff}
%\begin{minipage}{6in}}
%{\end{minipage}\end{lrbox}}

%\DefineVerbatimEnvironment{chapelpre}{Verbatim}{}
\newenvironment{chapelpre}{BLOCK-test-chapelpre}{}

%\newenvironment{chapelnoprint} {\begin{lrbox}{\teststuff}
%\begin{minipage}{6in}}
%{\end{minipage}\end{lrbox}}

%\DefineVerbatimEnvironment{chapelnoprint}{Verbatim}{}
\newenvironment{chapelnoprint}{BLOCK-test-chapelnoprint}{}

%\newenvironment{chapelpost} {\begin{lrbox}{\teststuff}
%\begin{minipage}{6in}}
%{\end{minipage}\end{lrbox}}

%\DefineVerbatimEnvironment{chapelpost}{Verbatim}{}
\newenvironment{chapelpost}{BLOCK-test-chapelpost}{}


%
% .future file
%
%\newenvironment{chapelfuture} {\begin{lrbox}{\teststuff}
%\begin{minipage}{6in}}
%{\end{minipage}\end{lrbox}}

%\DefineVerbatimEnvironment{chapelfuture}{Verbatim}{}
\newenvironment{chapelfuture}{BLOCK-test-chapelfuture}{}

%
% .compopts file
%
%\newenvironment{chapelcompopts} {\begin{lrbox}{\teststuff}
%\begin{minipage}{6in}}
%{\end{minipage}\end{lrbox}}

%\DefineVerbatimEnvironment{chapelcompopts}{Verbatim}{}
\newenvironment{chapelcompopts}{BLOCK-test-chapelcompopts}{}

%
% .execopts file
%
%\newenvironment{chapelexecopts} {\begin{lrbox}{\teststuff}
%\begin{minipage}{6in}}
%{\end{minipage}\end{lrbox}}

\DefineVerbatimEnvironment{chapelexecopts}{Verbatim}{}
\newenvironment{chapelexecopts}{BLOCK-test-chapelexecopts}{}


%
% .good file
% To get more than one file, use a LaTeX style comment to name the
% .good file
%
%\newenvironment{chapeloutput} {\begin{lrbox}{\teststuff}
%\begin{minipage}{6in}}
%{\end{minipage}\end{lrbox}}

\DefineVerbatimEnvironment{chapeloutput}{Verbatim}{}
\newenvironment{chapeloutput}{BLOCK-test-chapeloutput}{}

%
% .no-local.good file
% (The naming feature mentioned above does not yet work, so this
% environment is a Q&D way to get a .no-local.good file.)
%
%\newenvironment{chapelwideoutput} {\begin{lrbox}{\teststuff}
%\begin{minipage}{6in}}
%{\end{minipage}\end{lrbox}}

%\DefineVerbatimEnvironment{chapelwideoutput}{Verbatim}{}
\newenvironment{chapelwideoutput}{BLOCK-test-chapelwideoutput}{}

%
% .prediff file
%
%\newenvironment{chapelprediff} {\begin{lrbox}{\teststuff}
%\begin{minipage}{6in}}
%{\end{minipage}\end{lrbox}}

%\DefineVerbatimEnvironment{chapelprediff}{Verbatim}{}
\newenvironment{chapelprediff}{BLOCK-test-chapelprediff}{}

%
% .good file that is printed in the text of the Spec
% To get more than one file, use a LaTeX style comment to name the
% .good file
%
%\lstnewenvironment{chapelprintoutput} 
% (See chapel_listing.tex for the implementation.)

%\DefineVerbatimEnvironment{chapeloutputname}{Verbatim}{}
\newenvironment{chapeloutputname}{BLOCK-test-chapeloutputname}{}
