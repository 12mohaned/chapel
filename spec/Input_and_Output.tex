\sekshun{Input and Output}
\label{Input_and_Output}

Chapel provides a built-in \chpl{file} type to handle input and output
to files using functions and methods called \chpl{read}, \chpl{write},
and \chpl{writeln}.

\subsection{The {\em file} type}
\index{file type}

The file type contains the following fields:
\begin{itemize}
\item
The \chpl{filename} field is a \chpl{string} that contains the name of
the file.
\item
The \chpl{path} field is a \chpl{string} that contains the path of the
file.
\item
The \chpl{mode} field is a \chpl{string} that indicates whether the
file is being read or written.
\item
The \chpl{style} field can be set to \chpl{text} or \chpl{binary} to
specify that reading from or writing to the file should be done with
text or binary formats.
\end{itemize}
These fields can be modified any time that the file is closed.

The \chpl{mode} field supports the following strings:
\begin{itemize}
\item
\chpl{"r"} The file can be read.
\item
\chpl{"w"} The file can be written.
\end{itemize}

\begin{status}
The \chpl{style} field is not yet implemented.  All input and output
is done in text mode.  All files must be text files.

There is an expectation that there will be more styles to control the
default reading and writing methods.
\end{status}

The file type supports the following methods:
\index{file type!methods}
\begin{itemize}
\item
The \chpl{open()} method opens the file for reading and/or writing.
\item
The \chpl{close()} method closes the file for reading and/or writing.
\item
The \chpl{isOpen} method returns true if the file is open for reading
and/or writing, and otherwise returns false.
\item
The \chpl{flush()} method flushes the file, finishing outstanding
reading and writing.
\end{itemize}

Additionally, the file type supports the
methods \chpl{read}, \chpl{write}, and \chpl{writeln} for input and
output as discussed in~\rsec{filewrite} and~\rsec{fileread}.

\subsection{Standard files {\em stdout}, {\em stdin}, and {\em stderr}}
\index{file type!standard files}

The files \chpl{stdout}, \chpl{stdin}, and \chpl{stderr} are
predefined and map to standard output, standard input, and standard
error as implemented in a platform dependent fashion.

\subsection{The {\em write}, {\em writeln}, and {\em read} functions}
\index{writeln@\chpl{writeln}}
\index{write@\chpl{write}}
\index{read@\chpl{read}}
\index{read}
\index{write}

The built-in function \chpl{write} can take an arbitrary number of
arguments and writes each of the arguments out in turn
to \chpl{stdout}.  The built-in function \chpl{writeln} has the same
semantics as \chpl{write} but outputs an {\em end-of-line} character
after writing out the arguments.  The built-in function \chpl{read}
can take an arbitrary number of arguments and reads each of the
arguments in turn from \chpl{stdin}.

These functions are wrappers for the methods on files described next.

\begin{example}
The \chpl{writeln} wrapper function allows for a simple implementation
of the {\em Hello-World} program:
\begin{chapel}
writeln("Hello, World!");
\end{chapel}
\end{example}

\subsection{User-Defined {\em writeThis} methods}

To define the output for a given type, the user must define a method
called \chpl{writeThis} on that type that takes a single argument of
\chpl{Writer} type.  If such a method does not exist, a default method is
created.

\subsection{The {\em write} and {\em writeln} method on files}
\label{filewrite}
\index{write!on files}

The \chpl{file} type supports methods \chpl{write} and \chpl{writeln}
for output.  These methods are defined to take an arbitrary number of
arguments.  Each argument is written in turn by calling
the \chpl{writeThis} method on that argument.
Default \chpl{writeThis} methods are bound to any type that the user
does not explicitly create one for.

A lock is used to ensure that output is serialized across multiple
computations.

\subsubsection{The {\em write} and {\em writeln} method on strings}
\label{stringwrite}
\index{write!on strings}

The \chpl{write} and \chpl{writeln} methods can also be called on
strings to write the output to a string instead of a file.

\subsubsection{Generalized {\em write} and {\em writeln}}
\label{writer}
\index{Writer@\chpl{Writer}}

The \chpl{Writer} class contains no arguments and serves as a base
class to allow user-defined classes to be written to.  If a class is
defined to be a subclass of Writer, it must override
the \chpl{writeIt} method that takes a \chpl{string} as an argument.

\begin{example}
The following code defines a subclass of \chpl{Writer} that overrides
the \chpl{writeIt} method to allow it to be written to.  It also
overrides the \chpl{writeThis} method to override the default way that
it is written.
\begin{chapel}
class C: Writer {
  var data: string;
  def writeIt(s: string) {
    data += s.substring(1);
  }
  def writeThis(x: Writer) {
    x.write(data);
  }
}

var c = C();
c.write(41, 32, 23, 14);
writeln(c);
\end{chapel}
The \chpl{C} class filters the arguments sent to it, printing out only
the first letter.  The output to the above is thus \chpl{4321}.
\end{example}


\subsection{The {\em read} method on files}
\label{fileread}
\index{read!on files}

The \chpl{file} type supports a method \chpl{read} that takes an
arbitrary number of arguments.  Each argument is read in turn by
calling a method also bound to the \chpl{file} type that takes a
single argument of that type.

\subsection{Default {\em read} and {\em write} methods}
\index{write!default methods}
\index{read!default methods}

Default \chpl{write} methods are created for all types for which a user
\chpl{write} method is not defined.  They have the following semantics:
\begin{itemize}
\item
{\bf arrays} Outputs the elements of the array in row-major order
where rows are separated by line-feeds and blank lines are used to
separate other dimensions.
\item
{\bf domains} Outputs the dimensions of the domain enclosed
by \chpl{[} and \chpl{]}.
\item
{\bf ranges} Outputs the lower bound of the range followed
by \chpl{..} followed by the upper bound of the range.  If the stride
of the range is not one, the output is additionally followed by the
word \chpl{by} followed by the stride of the range.
\item
{\bf tuples} Outputs the components of the tuple in order delimited
by \chpl{(} and \chpl{)}, and separated by commas.
\item
{\bf classes} Outputs the values within the fields of the class
prefixed by the name of the field and the character \chpl{=}.  Each
field is separated by a comma.  The output is delimited by \chpl{\{}
and \chpl{\}}.
\item
{\bf records} Outputs the values within the fields of the class
prefixed by the name of the field and the character \chpl{=}.  Each
field is separated by a comma.  The output is delimited by \chpl{(}
and \chpl{)}.
\end{itemize}

Default \chpl{read} methods are created for all types for which a user
\chpl{read} method is not defined.  The default \chpl{read} methods are
defined to read in the output of the default \chpl{write} method.
