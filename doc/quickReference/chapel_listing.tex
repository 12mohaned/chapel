\lstdefinelanguage{chapel}
  {
    morekeywords={
      and, array, atomic,
      begin, bool, break, by,
      call, class, cobegin, complex, config, const, constructor, continue,
      def, distributed, do, domain,
      else, enum, except,
      false, for, forall,
      goto,
      if, imag, implements, in, int, inout, _invariant, iterator,
      let, like, locale,
      module,
      nil, not,
      on, or, ordered, otherwise, out,
      param, pragma, _private, private, public,
      range, real, record, reduce, _release, repeat, return,
      scan, select, serial, single, subtype, sync, string,
      then, to, true, type, typeselect,
      uint, union, until, _unordered, use,
      var, _view,
      when, where, while, with,
      yield
    },
    sensitive=false,
    mathescape=false,
    morecomment=[l]{//},
    morecomment=[s]{/*}{*/},
    morestring=[b]",
}

\lstset{
    basicstyle=\scriptsize\ttfamily,
    keywordstyle=\bfseries,
    commentstyle=\em,
    showstringspaces=false,
    flexiblecolumns=false,
    numbers=left,
    numbersep=5pt,
    numberstyle=\tiny,
    numberblanklines=false,
    stepnumber=0,
    escapeinside={(*}{*)},
    language=chapel,
  }

%\newcommand{\chpl}[1]{\lstinline[language=chapel,basicstyle=\ttfamily,keywordstyle=\bfseries]!#1!}
\newcommand{\chpl}[1]{\lstinline[language=chapel,basicstyle=\scriptsize\ttfamily,keywordstyle=\bfseries]!#1!}
\newcommand{\varname}[1]{\emph{#1}}
\newcommand{\typename}[1]{\emph{#1}}
\newcommand{\fnname}[1]{\chpl{#1}}

\lstnewenvironment{chapel}{\lstset{language=chapel,stepnumber=0}}{}

\lstnewenvironment{chapelcode}{\lstset{language=chapel,stepnumber=1}}{}

\lstnewenvironment{commandline}{\lstset{keywordstyle=}}{}
