

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Chapel stack traces &mdash; chpldoc 0.0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="chpldoc 0.0.1 documentation" href="../index.html"/>
        <link rel="next" title="Constrained Generics" href="2.html"/>
        <link rel="prev" title="Record Copying in Chapel" href="13.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> chpldoc
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">chpldoc documentation</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="1.html">Chapel Improvement Proposals</a></li>
<li class="toctree-l1"><a class="reference internal" href="10.html">Initializers</a></li>
<li class="toctree-l1"><a class="reference internal" href="11.html">Alternative Initializer Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="12.html">Basics of Initialization</a></li>
<li class="toctree-l1"><a class="reference internal" href="13.html">Record Copying in Chapel</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Chapel stack traces</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#abstract">Abstract</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rationale">Rationale</a></li>
<li class="toctree-l2"><a class="reference internal" href="#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#unwind-phase">Unwind phase</a></li>
<li class="toctree-l2"><a class="reference internal" href="#native-symbols-phase">Native symbols phase</a></li>
<li class="toctree-l2"><a class="reference internal" href="#chapel-symbols-phase">Chapel symbols phase</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="2.html">Constrained Generics</a></li>
<li class="toctree-l1"><a class="reference internal" href="3.html">ZeroMQ Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.html">Constructor Syntax and Semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="5.html">Implement Object Copying Using a &#8220;Postblit&#8221; Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="6.html">Tuple Semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="7.html">Rules for inserting autoCopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="8.html">Error Handling in Chapel</a></li>
<li class="toctree-l1"><a class="reference internal" href="9.html">Chapel Package Manager</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">chpldoc</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>Chapel stack traces</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/modules/14.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="chapel-stack-traces">
<h1>Chapel stack traces<a class="headerlink" href="#chapel-stack-traces" title="Permalink to this headline">¶</a></h1>
<dl class="docutils">
<dt>Status</dt>
<dd>Draft</dd>
<dt>Author</dt>
<dd>Andrea Francesco Iuorio</dd>
</dl>
<div class="section" id="abstract">
<h2>Abstract<a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h2>
<p>This document presents a solution for getting a stack trace from a Chapel
application.</p>
</div>
<div class="section" id="rationale">
<h2>Rationale<a class="headerlink" href="#rationale" title="Permalink to this headline">¶</a></h2>
<p>The current implementation of the halt() procedure prints an user-provided
error message but it gives no informations about where or how the error
occurred. Having a stack trace with line numbers can be helpful for
understanding where and in which conditions the error is raised.</p>
</div>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>Since Chapel programs are compiled into C and then into native binaries, the
call stack and the binary symbols table will contain the native symbols, not
the Chapel ones. Also, the call stack will include all the runtime calls. This
is not desirable and the generated stack trace should only presents Chapel
symbols.</p>
<p>We can divide this feature into 3 phases:</p>
<p>1) An unwind phase, which gets the current stack state as a stack of pointers
to functions
2) A native symbols phase, which converts the pointers into a human-readable
format using the application symbols table
3) A Chapel symbol phase, which converts those symbols into Chapel symbols</p>
</div>
<div class="section" id="unwind-phase">
<h2>Unwind phase<a class="headerlink" href="#unwind-phase" title="Permalink to this headline">¶</a></h2>
<p>The unwind phase uses a layer for stack unwinding, i.e. the operation of
getting the function pointers of the functions currently in the call stack.
This layer is implemented using an external library as a little wrapper for the
library itself. In this way the runtime can get the call stack in an extensible
way.</p>
<p>The user can select the unwind library using an environment variable, for
example CHPL_UNWIND. If an unwind library is not specified, the runtime doesn&#8217;t
produce a stack trace.</p>
<p>A candidate as the unwind library is <a class="reference external" href="http://www.nongnu.org/libunwind/index.html">libunwind</a>.
libunwind is a MIT licensed library for stack unwinding under Linux on several
architectures.</p>
<p>On OSX, Apple provides in the operating system a <a class="reference external" href="https://opensource.apple.com/source/libunwind/libunwind-35.3/">library</a>
with a compatible API to libunwind under the Apple Public Source License 2.0.</p>
</div>
<div class="section" id="native-symbols-phase">
<h2>Native symbols phase<a class="headerlink" href="#native-symbols-phase" title="Permalink to this headline">¶</a></h2>
<p>This phase converts the function pointers into their symbolic representations,
using a layer to provide abstraction for this operation.</p>
<p>As for the implementation itself, both of the suggested libraries can be used
for translating the pointers into symbols.</p>
</div>
<div class="section" id="chapel-symbols-phase">
<h2>Chapel symbols phase<a class="headerlink" href="#chapel-symbols-phase" title="Permalink to this headline">¶</a></h2>
<p>This phase converts the native symbols into Chapel symbols. A table, generated
at compile time, will be added to the generated C code. This table will be
indexed by the function&#8217;s native name and will contain at least the Chapel name
of the procedure and its position in the source file. A compiler flag will be
added to give the possibility to disable the table&#8217;s generation.</p>
<p>Using this table, the runtime can convert the stack of native symbols into a
stack of Chapel symbols. During this operation the runtime will be able to
remove from this stack all the non-Chapel functions, like the runtime&#8217;s
internal operations.</p>
<p>After this last conversion, the runtime will have a stack of Chapel functions
representing the current call stack and it will printed when the halt
procedure is called.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="2.html" class="btn btn-neutral float-right" title="Constrained Generics" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="13.html" class="btn btn-neutral" title="Record Copying in Chapel" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, .

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 



</body>
</html>