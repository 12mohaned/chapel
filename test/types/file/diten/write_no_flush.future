bug: channel is not flushed when file is closed

Data that was written to the channel is missing after the file is closed.
