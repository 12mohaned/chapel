#!/usr/bin/env perl

$memfile = "/proc/meminfo";
$memfree = "unknown";

if (-r $memfile) {
  open MEMFILE, "$memfile" or die "can't open $memfile $!";
  my @memLines = <MEMFILE>;
  close (MEMFILE);

  foreach my $line (@memLines) {
    if ($line =~ m/MemTotal: (\s*)(\S*)/) {
      $memfree = "$2";
    }
  }
} else {
    $system = `uname -s`; chomp($system);
    if ($system eq "Darwin") {
	$mem = `system_profiler | grep "   Memory:"`;
	if ($mem =~ m/(\s*)Memory: (\s*)(\S*) GB/) {
	    $memInGB = "$3";
	    $memfree = $memInGB * 1024 * 1024;
	} else {
#	    printf "Unexpected system_profiler output\n";
	}
#	printf "On darwin and mem is $memfree!\n";
    }
}

if ($memfree ne "unknown") {
    $hostname = `hostname -s`; chomp($hostname);
#    printf "Running ./countMemory.makegood $memfree\n";
    system("./countMemory.makegood $memfree > countMemory.$hostname.good");
}
