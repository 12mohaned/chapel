use LinearAlgebra;
use TestUtils;

// TODO: real(32), real(64), complex(64)
// TODO: Test A = U.dot(s).dot(Vt);
// TODO: AssertEqual -> AssertApproximate

// Generated 9x6 matrix
var A = Matrix([-1.69076753+0.40781212i,  0.79197852+0.23827023i,
                 1.12554038-1.56765808i,  0.80566169+0.36370628i,
                 1.81044518-1.25550609i, -0.91643576-0.55232041i],
                 [ 0.51221811-0.34031552i, -0.01985695+1.68504174i,
                   0.46780635+0.66329761i, -0.1816969 +1.55946839i,
                  -2.0954999 +0.70406511i, -1.47853628+1.5275366i ],
                 [ 1.62774313+2.61548849i,  0.57103428-0.07781075i,
                  -0.62563568-0.5072348i ,  0.18353745+1.22016414i,
                  -1.25794828-0.13846345i,  1.43515164-0.08407337i],
                 [ 0.35852349-0.55846017i,  0.91243787-0.85194661i,
                   0.04251238+0.36573118i, -0.04169952+0.72534489i,
                   0.62976977+0.29766468i, -0.546961  -0.84079693i],
                 [ 0.50946288+2.5088256i , -0.84031679+0.04466812i,
                  -0.24318416-0.14666673i, -0.55424144+2.10225376i,
                   1.38935921+1.77619808i,  0.60372941+0.76648907i],
                 [-0.01788549+0.17520556i,  1.0832307 -0.35184781i,
                   0.17661588+0.08661088i, -0.91565893+0.92865473i,
                  -1.9852235 +0.16419744i,  1.64455788+1.99220277i],
                 [ 0.53790337-0.97263733i, -1.22084598-0.41043638i,
                   0.3154504 -1.08394827i,  0.09896473+0.13250015i,
                  -0.74277683+0.72316633i,  0.18707414-1.35285067i],
                 [-0.48533805-0.51941553i,  0.64357458-0.04634378i,
                   1.12882469-0.16620122i,  1.59862835+1.50011731i,
                  -1.50579357+0.32926318i, -0.42428757+0.16766345i],
                 [ 1.27128167-0.49955293i, -0.34048175-1.42808302i,
                   0.63262329+1.00843442i,  1.02491408-1.66046278i,
                  -0.56163758+2.05903763i,  2.44120055+0.18187359i]);

var (u, s, vt) = svd(A);

// Generated solutions
var uRef = Matrix([-0.30763784-0.11108634i,  0.19832189-0.29328579i,
                  -0.04363909-0.43123726i,  0.3005643 +0.0925822i,
                  -0.07658883+0.01123764i,  0.23082547+0.16928822i,
                  -0.09842916+0.00994696i, -0.03257285+0.11699355i,
                   0.44609632+0.41160864i],
                 [-0.0125381 +0.32477627i,  0.03154072+0.43771198i,
                   0.42250787-0.07684085i, -0.12022598-0.21161981i,
                  -0.27607903-0.06150987i,  0.20955904+0.18959851i,
                  -0.18258178+0.20558313i, -0.3687031 +0.04300037i,
                   0.25634443-0.13839165i],
                 [ 0.2496943 +0.31768115i, -0.249876  -0.38614388i,
                   0.10960064+0.09566929i,  0.2412773 -0.0414345i ,
                  -0.16883907+0.25254163i,  0.0496515 +0.30154788i,
                  -0.21577897-0.21800267i, -0.09009109+0.39761729i,
                  -0.31035229+0.04230104i],
                 [ 0.02799613-0.10181415i, -0.04552042+0.02290233i,
                   0.1314741 -0.11458324i,  0.12577068+0.07449011i,
                   0.65911757+0.13745908i,  0.30161123+0.00992665i,
                   0.01987431-0.35892007i, -0.43049837-0.11225416i,
                   0.02196979-0.24988339i],
                 [ 0.16325314+0.12354109i,  0.19396591-0.5273601i ,
                   0.49221329+0.12531651i, -0.23512537-0.22937337i,
                   0.11357834-0.32629903i,  0.19442758-0.1056272i ,
                   0.12689032-0.05598119i,  0.23032085-0.14574947i,
                   0.11937762+0.01932318i],
                 [ 0.19939472+0.38789403i,  0.1731463 +0.11759291i,
                  -0.032717  +0.13716249i,  0.09704351+0.38192987i,
                  -0.05515745+0.11222366i,  0.11630415-0.49889224i,
                  -0.39399302-0.19303493i,  0.05570015-0.23203004i,
                   0.10912343+0.22672108i],
                 [ 0.1055288 -0.18087135i, -0.06243811+0.12104296i,
                   0.07389536+0.12820095i,  0.41618732-0.26126281i,
                  -0.33799061-0.01937599i,  0.22200638-0.39576132i,
                   0.49512955-0.15688391i, -0.21379391+0.0331545i ,
                  -0.06207133+0.18242941i],
                 [ 0.08864088+0.13792247i,  0.12094818+0.24051388i,
                   0.12492032-0.37397858i,  0.46555495-0.10146957i,
                  -0.04331224-0.14415192i, -0.12471764+0.1785919i ,
                   0.01806135-0.27851353i,  0.48604888-0.20411043i,
                  -0.07945137-0.29312772i],
                 [ 0.53789897-0.14409575i,  0.05655503+0.11899828i,
                  -0.31564012+0.14588046i, -0.15035074+0.07910053i,
                  -0.08576602-0.29792229i,  0.00236597+0.29830508i,
                   0.0594825 -0.35830137i, -0.04246215+0.15990321i,
                   0.42200555+0.01691783i]);

var sRef = Vector(7.09766911, 5.12440368, 4.69026828, 3.45325808, 2.29608793, 1.51776674);


var vtRef = Matrix([ 0.42175249+0.0i        ,  0.06679475-0.2374364i ,
                     0.02768393+0.12601622i,  0.28903265+0.06063958i,
                    -0.18531017+0.5386541i ,  0.57633829+0.0277453i ],
                   [-0.69525117+0.0i        ,  0.10032626-0.00991916i,
                     0.29644315-0.14439133i, -0.11896799+0.0226030i,
                     0.11082484+0.52911733i,  0.09501722+0.28599794i],
                   [ 0.18006425+0.0i        , -0.13648328+0.38860582i,
                     0.1115401 +0.15536153i, -0.23348678+0.75467172i,
                     0.13190532+0.25887721i, -0.14857896-0.17555252i],
                   [-0.21084919+0.0i        ,  0.02836542-0.35741459i,
                     0.28430354-0.36926292i,  0.06870904+0.32830455i,
                    -0.43864801-0.18840596i,  0.06170276-0.5153526i ],
                   [-0.09082863+0.0i        ,  0.3731959 -0.63237529i,
                    -0.28873986+0.41622922i, -0.11450313+0.18843145i,
                     0.17924711+0.10364976i, -0.31203008-0.08429735i],
                   [ 0.50360728+0.0i        ,  0.21055009-0.21748948i,
                     0.4131426 -0.43995435i, -0.31469594-0.1179724i ,
                     0.10970231+0.12661715i, -0.32880544+0.20339499i]);

assertEqual(s, sRef, 's');
assertEqual(u, uRef, 'u');
assertEqual(vt, vtRef, 'vt');
